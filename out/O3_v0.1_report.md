# O3 Function Start Detector v0.1

## Commands
- `source .venv/bin/activate && python -V`
- `objdump --version`
- `source .venv/bin/activate && python src/train_start_detector.py --train_glob "data/build/*/O0/*_sym" --train_glob "data/build/*/O3/*_sym" --model_path models/start_detector_v0.1.joblib`
- `source .venv/bin/activate && for thr in 0.25 0.30 0.33 0.35 0.40 0.45 0.55; do THRESH=$thr MODEL_PATH=models/start_detector_v0.1.joblib src/run_batch_predict.sh; cp out/summary.tsv "out/summary_thr_${thr}.tsv"; cp out/logs/run_batch_predict.log "out/logs/run_batch_predict_thr_${thr}.log"; done`

## Artifacts
- `models/start_detector_v0.1.joblib`
- `out/summary_thr_0.25.tsv` … `out/summary_thr_0.55.tsv`
- `out/logs/run_batch_predict_thr_*.log`
- `notes/ghidra_compare_TODO.md`
- `out/O3_v0.1_report.md`

## Threshold Sweep (Macro Metrics)

| Threshold | Macro P | Macro R | Macro F1 |
|-----------|---------|---------|----------|
| 0.25 | 0.693 | 0.906 | 0.783 |
| 0.30 | 0.727 | 0.906 | 0.804 |
| 0.33 | 0.754 | 0.906 | 0.819 |
| 0.35 | 0.754 | 0.906 | 0.819 |
| **0.40** | **0.857** | **0.801** | **0.821** |
| 0.45 | 0.889 | 0.726 | 0.792 |
| 0.55 | 0.958 | 0.587 | 0.724 |

Chosen threshold: **0.40** (highest macro F1; ties broken on higher recall).

## Per-Binary Metrics @ Threshold 0.40

| Binary | TP | FP | FN | P | R | F1 |
|--------|----|----|----|---|---|----|
| hello | 8 | 0 | 2 | 1.000 | 0.800 | 0.889 |
| mathlib | 7 | 0 | 1 | 1.000 | 0.875 | 0.933 |
| sort | 8 | 6 | 3 | 0.571 | 0.727 | 0.640 |

## Interpretation
- Expanded candidates plus ±6/±3 context lifted recall on O3 binaries (e.g., `hello` jumps from 0.300 → 0.800) while extra n-grams kept precision steady on mathlib.
- Alignment-derived candidates introduce new sort-specific false positives; precision dips once padding heuristics saturate.
- Windowed xref degree and padding counts favor structured prologues, tightening scores above the 0.40 threshold without sacrificing logistic stability.

## Next Actions (Week #05 plan)
1. Add a post-filter to down-rank alignment-only hits (sort’s padded blocks).
2. Explore lightweight CFG checks or prologue consistency to recover remaining FN clusters.
3. Complete the Ghidra export script once tooling lands to cross-validate boundaries against headless disassembly.
